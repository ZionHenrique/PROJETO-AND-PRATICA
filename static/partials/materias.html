<div class="cartao">
  <h3>Matérias</h3>
  <p class="sub">Adicione, remova ou gerencie suas matérias.</p>

  <div style="margin-top:10px">
    <label>Nome da matéria</label>
    <input id="mat-name" placeholder="Ex: Física" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="mat-add" class="botao">Adicionar</button>
      <button id="mat-refresh" class="botao" style="background:#34d399">Atualizar</button>
    </div>
    <div id="mat-result" class="resultado" style="display:none"></div>

    <h4 style="margin-top:12px">Matérias cadastradas</h4>
    <table id="mat-table"><thead><tr><th>Nome</th><th>Ações</th></tr></thead><tbody></tbody></table>
  </div>
</div>

<script>
async function refreshMats(){
  const res = await fetch('/api/subjects'); const subs = await res.json();
  const tbody = document.querySelector('#mat-table tbody'); tbody.innerHTML = '';
  subs.forEach(s=> tbody.insertAdjacentHTML('beforeend', `<tr data-id="${s.id}"><td>${s.name}</td><td><button class="del">🗑️</button></td></tr>`));
  document.querySelectorAll('#mat-table .del').forEach(b=>b.onclick = async (e)=>{
    const id = e.target.closest('tr').dataset.id;
    if (!confirm('Remover matéria?')) return;
    await fetch('/api/subjects?id='+id, {method:'DELETE'}); refreshMats();
  });
}
document.getElementById('mat-add').onclick = async ()=>{
  const name = document.getElementById('mat-name').value.trim();
  if (!name) return alert('Nome vazio');
  const res = await fetch('/api/subjects', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name})});
  if (res.ok) { document.getElementById('mat-result').style.display='block'; document.getElementById('mat-result').innerText='Adicionada!'; document.getElementById('mat-name').value=''; refreshMats(); setTimeout(()=>document.getElementById('mat-result').style.display='none',1000); }
};
document.getElementById('mat-refresh').onclick = refreshMats;
window.addEventListener('tab-changed', async (e)=>{ if (e.detail !== 'materias') return; refreshMats(); });
</script>
